  <script>
    const QUESTION_TIME = 30; // seconds per question
    let mode = "all";         // "all" or "short"
    let currentChapter = "All";

    // Question bank ‚Äì board-style (you can add more)
    const allQuestions = [
      // 1. Chemical Reactions & Equations ‚Äì MCQ
      {
        chapter: "Chemical Reactions & Equations",
        type: "mcq",
        q: "Which gas is released when zinc reacts with dilute hydrochloric acid?",
        options: ["Oxygen", "Carbon dioxide", "Hydrogen", "Nitrogen"],
        answer: 2
      },
      {
        chapter: "Chemical Reactions & Equations",
        type: "mcq",
        q: "Rusting of iron is an example of:",
        options: ["Oxidation", "Reduction", "Neutralisation", "Decomposition"],
        answer: 0
      },
      {
        chapter: "Chemical Reactions & Equations",
        type: "mcq",
        q: "Which of the following is a displacement reaction?",
        options: [
          "CaCO‚ÇÉ ‚Üí CaO + CO‚ÇÇ",
          "Zn + CuSO‚ÇÑ ‚Üí ZnSO‚ÇÑ + Cu",
          "N‚ÇÇ + 3H‚ÇÇ ‚Üí 2NH‚ÇÉ",
          "2H‚ÇÇO ‚Üí 2H‚ÇÇ + O‚ÇÇ"
        ],
        answer: 1
      },
      {
        chapter: "Chemical Reactions & Equations",
        type: "mcq",
        q: "Which type of reaction is: 2HgO ‚Üí 2Hg + O‚ÇÇ?",
        options: ["Combination", "Decomposition", "Displacement", "Double displacement"],
        answer: 1
      },

      // 2. Acids, Bases & Salts ‚Äì MCQ
      {
        chapter: "Acids, Bases & Salts",
        type: "mcq",
        q: "Which acid is present in vinegar?",
        options: ["Citric acid","Acetic acid","Hydrochloric acid","Sulphuric acid"],
        answer: 1
      },
      {
        chapter: "Acids, Bases & Salts",
        type: "mcq",
        q: "What is the pH of a neutral solution at 25¬∞C?",
        options: ["0","7","14","1"],
        answer: 1
      },
      {
        chapter: "Acids, Bases & Salts",
        type: "mcq",
        q: "Which salt is called baking soda?",
        options: ["NaCl","NaHCO‚ÇÉ","Na‚ÇÇCO‚ÇÉ","CaCO‚ÇÉ"],
        answer: 1
      },
      {
        chapter: "Acids, Bases & Salts",
        type: "mcq",
        q: "Tooth decay starts when pH of mouth falls below:",
        options: ["7.0","6.5","5.5","4.5"],
        answer: 2
      },

      // 3. Metals & Non-metals ‚Äì MCQ
      {
        chapter: "Metals & Non-metals",
        type: "mcq",
        q: "Which metal is liquid at room temperature?",
        options: ["Iron","Mercury","Aluminium","Sodium"],
        answer: 1
      },
      {
        chapter: "Metals & Non-metals",
        type: "mcq",
        q: "Which property of metals allows them to be drawn into wires?",
        options: ["Malleability","Ductility","Conductivity","Sonority"],
        answer: 1
      },
      {
        chapter: "Metals & Non-metals",
        type: "mcq",
        q: "Which metal is used for galvanisation of iron?",
        options: ["Copper","Zinc","Silver","Lead"],
        answer: 1
      },

      // 4. Carbon & Its Compounds ‚Äì MCQ
      {
        chapter: "Carbon & Its Compounds",
        type: "mcq",
        q: "How many covalent bonds are present in a methane (CH‚ÇÑ) molecule?",
        options: ["1","2","3","4"],
        answer: 3
      },
      {
        chapter: "Carbon & Its Compounds",
        type: "mcq",
        q: "The IUPAC name of CH‚ÇÉ‚ÄìCH‚ÇÇ‚ÄìCH‚ÇÇ‚ÄìCH‚ÇÉ is:",
        options: ["Propane","Methane","Butane","Ethane"],
        answer: 2
      },
      {
        chapter: "Carbon & Its Compounds",
        type: "mcq",
        q: "What is the common name of ethanoic acid?",
        options: ["Formic acid","Acetic acid","Oxalic acid","Citric acid"],
        answer: 1
      },

      // SHORT ‚Äì Chemical Reactions & Equations
      {
        chapter: "Chemical Reactions & Equations",
        type: "short",
        q: "Define oxidation in terms of oxygen.",
        acceptableAnswers: [
          "addition of oxygen",
          "gain of oxygen",
          "addition of oxygen to a substance"
        ]
      },
      {
        chapter: "Chemical Reactions & Equations",
        type: "short",
        q: "Write the balanced chemical equation for magnesium burning in oxygen.",
        acceptableAnswers: [
          "2mg + o2 ‚Üí 2mgo",
          "2 mg + o2 ‚Üí 2 mgo",
          "2mg+o2‚Üí2mgo"
        ]
      },

      // SHORT ‚Äì Acids, Bases & Salts
      {
        chapter: "Acids, Bases & Salts",
        type: "short",
        q: "Name the acid present in lemon.",
        acceptableAnswers: ["citric acid"]
      },
      {
        chapter: "Acids, Bases & Salts",
        type: "short",
        q: "Name the gas that turns lime water milky.",
        acceptableAnswers: ["carbon dioxide","co2","carbon dioxide gas"]
      },

      // SHORT ‚Äì Metals & Non-metals
      {
        chapter: "Metals & Non-metals",
        type: "short",
        q: "Which property of metals allows them to be beaten into thin sheets?",
        acceptableAnswers: ["malleability","it is malleable"]
      },
      {
        chapter: "Metals & Non-metals",
        type: "short",
        q: "Why is sodium stored in kerosene?",
        acceptableAnswers: [
          "because it is highly reactive",
          "it reacts vigorously with air and water",
          "it reacts with air and water"
        ]
      },

      // SHORT ‚Äì Carbon & Its Compounds
      {
        chapter: "Carbon & Its Compounds",
        type: "short",
        q: "Name the functional group present in ethanol (C‚ÇÇH‚ÇÖOH).",
        acceptableAnswers: ["hydroxyl","oh","oh group","‚Äìoh"]
      },
      {
        chapter: "Carbon & Its Compounds",
        type: "short",
        q: "What do we call a series of organic compounds having the same functional group and successive members differing by ‚ÄìCH‚ÇÇ‚Äì unit?",
        acceptableAnswers: ["homologous series"]
      }
    ];

    // STATE
    let questions = [];
    let current = 0;
    let score = 0;
    let timeLeft = QUESTION_TIME;
    let timerId = null;
    let locked = false;
    let playerName = "";

    const contentEl = document.getElementById("content");
    const scoreEl = document.getElementById("score");
    const timerEl = document.getElementById("timer");
    const progressInner = document.getElementById("progress-inner");
    const playerNameLabel = document.getElementById("playerNameLabel");
    const modeAllBtn = document.getElementById("modeAll");
    const modeShortBtn = document.getElementById("modeShort");
    const chapterButtons = document.querySelectorAll(".chapter-toggle .pill-btn");

    // AUDIO
    let audioContext = null;
    function initAudio() {
      try {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      } catch (e) {
        audioContext = null;
      }
    }
    function playBeep(freq, duration) {
      if (!audioContext) return;
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.type = "sine";
      osc.frequency.value = freq;
      osc.connect(gain);
      gain.connect(audioContext.destination);
      const now = audioContext.currentTime;
      gain.gain.setValueAtTime(0.15, now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + duration / 1000);
      osc.start(now);
      osc.stop(now + duration / 1000);
    }
    function playCorrectSound() {
      playBeep(800, 150);
      setTimeout(() => playBeep(1000, 150), 160);
    }
    function playWrongSound() {
      playBeep(200, 200);
    }
    function playTimeUpSound() {
      playBeep(500, 150);
    }

    function getActiveQuestions() {
      let filtered = allQuestions;
      if (currentChapter !== "All") {
        filtered = filtered.filter(q => q.chapter === currentChapter);
      }
      if (mode === "short") {
        filtered = filtered.filter(q => q.type === "short");
      }
      return filtered;
    }

    function updateProgress() {
      const percent = questions.length ? (current / questions.length) * 100 : 0;
      progressInner.style.width = percent + "%";
    }

    function startTimer() {
      clearInterval(timerId);
      timeLeft = QUESTION_TIME;
      timerEl.textContent = "‚è± " + timeLeft + "s";
      timerId = setInterval(() => {
        if (timeLeft <= 1) {
          clearInterval(timerId);
          timeLeft = 0;
          timerEl.textContent = "‚è± 0s";
          handleTimeUp();
        } else {
          timeLeft -= 1;
          timerEl.textContent = "‚è± " + timeLeft + "s";
        }
      }, 1000);
    }

    function handleTimeUp() {
      if (locked) return;
      locked = true;
      playTimeUpSound();
      const msg = document.querySelector(".message");
      if (msg) msg.textContent = "‚è∞ Time up! Moving to next question.";

      const q = questions[current];
      if (q.type === "mcq") {
        const btns = contentEl.querySelectorAll(".option-btn");
        btns.forEach((btn, i) => {
          if (i === q.answer) btn.classList.add("correct");
          btn.classList.add("disabled");
        });
      }

      setTimeout(() => {
        nextQuestionOrEnd();
      }, 1200);
    }

    function nextQuestionOrEnd() {
      current++;
      if (current >= questions.length) {
        endGame();
      } else {
        updateProgress();
        renderQuestion();
      }
    }

    function handleOptionClick(i) {
      if (locked) return;
      locked = true;
      clearInterval(timerId);

      const q = questions[current];
      const correct = q.answer;
      const btns = contentEl.querySelectorAll(".option-btn");
      const msg = document.querySelector(".message");

      btns.forEach((btn, idx) => {
        btn.classList.add("disabled");
        if (idx === i && idx === correct) {
          btn.classList.add("correct");
        } else if (idx === i && idx !== correct) {
          btn.classList.add("wrong");
        } else if (idx === correct && i !== correct) {
          btn.classList.add("correct");
        }
      });

      if (i === correct) {
        score += 10;
        scoreEl.textContent = score;
        if (msg) {
          msg.textContent = "‚úÖ Correct! +10 points.";
          msg.classList.add("highlight");
        }
        playCorrectSound();
      } else {
        if (msg) {
          msg.textContent = "‚ùå Incorrect. Watch the correct answer.";
          msg.classList.remove("highlight");
        }
        playWrongSound();
      }

      setTimeout(() => {
        nextQuestionOrEnd();
      }, 1000);
    }

    function handleShortSubmit() {
      if (locked) return;
      const input = document.getElementById("shortAnswerInput");
      if (!input) return;
      const value = input.value.trim();
      const msg = document.querySelector(".message");
      const correctTextEl = document.getElementById("correctText");

      if (!value) {
        if (msg) msg.textContent = "Please type an answer before submitting.";
        return;
      }

      locked = true;
      clearInterval(timerId);

      const q = questions[current];
      const normalized = value.toLowerCase();
      const acceptable = (q.acceptableAnswers || []).map(a => a.toLowerCase());
      const isCorrect = acceptable.some(
        ans => normalized === ans || normalized.includes(ans)
      );

      if (isCorrect) {
        score += 10;
        scoreEl.textContent = score;
        if (msg) {
          msg.textContent = "‚úÖ Correct! +10 points.";
          msg.classList.add("highlight");
        }
        if (correctTextEl) correctTextEl.textContent = "";
        playCorrectSound();
      } else {
        const correctExample =
          (q.acceptableAnswers && q.acceptableAnswers[0]) || "Check your textbook.";
        if (msg) {
          msg.textContent =
            '‚ùå Not correct. Correct answer (example): "' + correctExample + '".';
          msg.classList.remove("highlight");
        }
        if (correctTextEl) {
          correctTextEl.textContent =
            'Example correct answer: "' + correctExample + '"';
        }
        playWrongSound();
      }

      setTimeout(() => {
        nextQuestionOrEnd();
      }, 1600);
    }

    function getTitle(finalScore) {
      if (finalScore >= 120) return "Chemistry Grandmaster";
      if (finalScore >= 80) return "Chemistry Champion";
      if (finalScore >= 50) return "Rising Scientist";
      return "Needs More Practice";
    }

    function saveScoreToLeaderboard(name, score) {
      const key = "chemistry_leaderboard_v1";
      const today = new Date().toISOString().slice(0, 10);
      let data = [];
      try {
        const stored = localStorage.getItem(key);
        if (stored) data = JSON.parse(stored);
      } catch (e) { data = []; }

      data.push({ name, score, date: today });
      const todayScores = data.filter(d => d.date === today);
      todayScores.sort((a,b) => b.score - a.score);
      const top5 = todayScores.slice(0,5);
      const older = data.filter(d => d.date !== today);
      const finalData = older.concat(top5);
      localStorage.setItem(key, JSON.stringify(finalData));
      return top5;
    }

    function endGame() {
      clearInterval(timerId);
      updateProgress();
      timerEl.textContent = "‚è± 0s";
      contentEl.innerHTML = "";

      const finalScore = score;
      const title = getTitle(finalScore);
      const today = new Date().toLocaleDateString("en-IN");

      const summary = document.createElement("div");
      summary.className = "summary";

      const cert = document.createElement("div");
      cert.className = "cert-card";

      const certTitle = document.createElement("div");
      certTitle.className = "cert-title";
      certTitle.textContent = "Certificate of Achievement";
      cert.appendChild(certTitle);

      const line1 = document.createElement("div");
      line1.className = "cert-line";
      line1.textContent = "This certifies that";
      cert.appendChild(line1);

      const nameLine = document.createElement("div");
      nameLine.className = "cert-name";
      nameLine.textContent = playerName || "Chemistry Player";
      cert.appendChild(nameLine);

      const line2 = document.createElement("div");
      line2.className = "cert-line";
      line2.textContent =
        "has completed the Chemistry Champion quiz with a score of " +
        finalScore +
        " points.";
      cert.appendChild(line2);

      const line3 = document.createElement("div");
      line3.className = "cert-line";
      line3.textContent = "Title earned: " + title;
      cert.appendChild(line3);

      const line4 = document.createElement("div");
      line4.className = "cert-line";
      line4.textContent = "Date: " + today;
      cert.appendChild(line4);

      summary.appendChild(cert);

      const top5 = saveScoreToLeaderboard(playerName || "Player", finalScore);
      const board = document.createElement("div");
      board.className = "leaderboard";

      const boardTitle = document.createElement("div");
      boardTitle.className = "leaderboard-title";
      boardTitle.textContent = "üèÖ Today's Top Scores";
      board.appendChild(boardTitle);

      const list = document.createElement("ul");
      list.className = "leaderboard-list";

      if (top5.length === 0) {
        const li = document.createElement("li");
        li.textContent = "No scores yet. Be the first!";
        list.appendChild(li);
      } else {
        top5.forEach((entry, index) => {
          const li = document.createElement("li");
          li.innerHTML =
            "<span>" +
            (index + 1) +
            ". " +
            entry.name +
            "</span><span>" +
            entry.score +
            " pts</span>";
          list.appendChild(li);
        });
      }

      board.appendChild(list);
      summary.appendChild(board);

      const btn = document.createElement("button");
      btn.className = "play-again-btn";
      btn.textContent = "Play Again";
      btn.onclick = () => {
        score = 0;
        scoreEl.textContent = score;
        questions = getActiveQuestions();
        current = 0;
        updateProgress();
        renderQuestion();
      };
      summary.appendChild(btn);

      contentEl.appendChild(summary);
    }

    function renderQuestion() {
      locked = false;
      clearInterval(timerId);

      if (!questions.length) {
        contentEl.innerHTML = "<p>No questions for this mode/chapter yet.</p>";
        timerEl.textContent = "‚è± 0s";
        progressInner.style.width = "0%";
        return;
      }

      const q = questions[current];
      updateProgress();
      startTimer();

      contentEl.innerHTML = "";

      const card = document.createElement("div");
      card.className = "card";

      const meta = document.createElement("div");
      meta.className = "meta-row";
      meta.innerHTML =
        "<span>Q" + (current + 1) + " of " + questions.length + "</span>" +
        "<span class='prize'>Practice Question</span>";
      card.appendChild(meta);

      const chap = document.createElement("div");
      chap.className = "chapter-tag";
      chap.textContent = q.chapter;
      card.appendChild(chap);

      const qText = document.createElement("div");
      qText.className = "question-text";
      qText.textContent = q.q;
      card.appendChild(qText);

      if (q.type === "mcq") {
        const optionsBox = document.createElement("div");
        optionsBox.className = "options";

        q.options.forEach((opt, idx) => {
          const btn = document.createElement("button");
          btn.className = "option-btn";
          btn.innerHTML =
            "<span class='label'>" +
            String.fromCharCode(65 + idx) +
            ".</span><span>" +
            opt +
            "</span>";
          btn.onclick = () => handleOptionClick(idx);
          optionsBox.appendChild(btn);
        });

        card.appendChild(optionsBox);
      } else {
        const input = document.createElement("input");
        input.type = "text";
        input.id = "shortAnswerInput";
        input.className = "short-input";
        input.placeholder = "Type your answer here";
        card.appendChild(input);

        const correctText = document.createElement("div");
        correctText.id = "correctText";
        correctText.className = "correct-text";
        card.appendChild(correctText);

        const btn = document.createElement("button");
        btn.className = "short-btn";
        btn.textContent = "Submit Answer";
        btn.onclick = handleShortSubmit;
        card.appendChild(btn);
      }

      contentEl.appendChild(card);

      const footerRow = document.createElement("div");
      footerRow.className = "footer-row";

      const message = document.createElement("div");
      message.className = "message";
      message.textContent = "Answer before the timer ends. Short answers are auto-checked.";
      footerRow.appendChild(message);

      contentEl.appendChild(footerRow);
    }

    function setMode(newMode) {
      mode = newMode;
      if (mode === "all") {
        modeAllBtn.classList.add("active");
        modeShortBtn.classList.remove("active");
      } else {
        modeShortBtn.classList.add("active");
        modeAllBtn.classList.remove("active");
      }
      score = 0;
      scoreEl.textContent = score;
      questions = getActiveQuestions();
      current = 0;
      updateProgress();
      renderQuestion();
    }

    function setChapter(ch) {
      currentChapter = ch;
      chapterButtons.forEach(btn => {
        const btnChapter = btn.getAttribute("data-chapter");
        if (btnChapter === ch) {
          btn.classList.add("active");
        } else if (ch === "All" && btnChapter === "All") {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
      score = 0;
      scoreEl.textContent = score;
      questions = getActiveQuestions();
      current = 0;
      updateProgress();
      renderQuestion();
    }

    modeAllBtn.onclick = () => setMode("all");
    modeShortBtn.onclick = () => setMode("short");

    chapterButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const ch = btn.getAttribute("data-chapter");
        setChapter(ch);
      });
    });

    (function init() {
      playerName = prompt("Enter player name (optional):") || "Player";
      playerNameLabel.textContent = playerName;
      initAudio();
      scoreEl.textContent = score;
      questions = getActiveQuestions();
      updateProgress();
      renderQuestion();
    })();
  </script>
